<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Creating Reusable Spells ü™Ñ</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
<h1 data-number="6" id="creating-reusable-spells"><span
class="header-section-number">6</span> Creating Reusable Spells ü™Ñ</h1>
<hr />
<h2 data-number="6.1" id="the-story-so-far-3"><span
class="header-section-number">6.1</span> The Story So Far‚Ä¶</h2>
<p>You‚Äôve become an expert at automation! With <code>for</code> loops,
you can command your program to inspect an entire army of cards with
just a few lines of code. Your code is powerful, but if you look
closely, our main file is becoming a bit of a messy scroll. The logic to
display a card is in one place, and the logic to find the fastest card
is in another.</p>
<p>What if you wanted to find the fastest card in the player‚Äôs deck,
<em>and also</em> in the computer‚Äôs deck? You‚Äôd have to copy and paste
that whole chunk of <code>for</code> loop code. A true master of
programming never copies and pastes code; they put it in a spellbook to
be used again and again.</p>
<h2 data-number="6.2"
id="the-mission-what-well-accomplish-today-4"><span
class="header-section-number">6.2</span> The Mission: What We‚Äôll
Accomplish Today</h2>
<p>Today, we‚Äôll learn how to create <strong>functions</strong>. A
function is a named, reusable block of code‚Äîlike a spell in a spellbook.
Our mission is to clean up our code by turning our existing logic into
powerful, reusable functions.</p>
<p>By the end of this session, our program will:</p>
<ol type="1">
<li>Have a clean <code>display_card()</code> function that can print the
stats for any card.</li>
<li>Have a powerful <code>find_fastest_card()</code> function that can
find the fastest card in <em>any</em> deck we give it.</li>
<li>Use these functions to find the fastest card in both the player‚Äôs
and the computer‚Äôs deck.</li>
</ol>
<h2 data-number="6.3" id="the-spellbook-new-tools-well-learn-4"><span
class="header-section-number">6.3</span> The Spellbook: New Tools We‚Äôll
Learn</h2>
<p><strong>1. Defining a Function (Writing the Spell)</strong></p>
<p>This is how you create a new function, or ‚Äúspell.‚Äù You give it a name
and tell it what ‚Äútarget‚Äù it needs to work on. This target is called a
<strong>parameter</strong>.</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode lua"><code class="sourceCode lua"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- This defines a function called &#39;shout&#39;.</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co">-- It takes one parameter, which we&#39;ll call &#39;message&#39;.</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> shout<span class="op">(</span><span class="va">message</span><span class="op">)</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">local</span> <span class="va">loud_message</span> <span class="op">=</span> <span class="fu">string.upper</span><span class="op">(</span><span class="va">message</span><span class="op">)</span> <span class="op">..</span> <span class="st">&quot;!!!&quot;</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span><span class="op">(</span><span class="va">loud_message</span><span class="op">)</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
<p>The code inside the function doesn‚Äôt run right away. We‚Äôve just
written the spell and added it to our spellbook for later.</p>
<p><strong>2. Calling a Function (Casting the Spell)</strong></p>
<p>To use the function, you ‚Äúcall‚Äù it by its name and give it the actual
data it needs to work on. This data is called an
<strong>argument</strong>.</p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode lua"><code class="sourceCode lua"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- Here, we call the &#39;shout&#39; function.</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co">-- The string &quot;hello&quot; is the argument we pass to the &#39;message&#39; parameter.</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>shout<span class="op">(</span><span class="st">&quot;hello&quot;</span><span class="op">)</span> <span class="co">-- Prints &quot;HELLO!!!&quot;</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>shout<span class="op">(</span><span class="st">&quot;I&#39;m learning functions&quot;</span><span class="op">)</span> <span class="co">-- Prints &quot;I&#39;M LEARNING FUNCTIONS!!!&quot;</span></span></code></pre></div>
<p>We wrote the logic once and can now use it on any message we
want!</p>
<p><strong>3. Returning a Value (Getting a Result)</strong></p>
<p>Some spells just perform an action (like <code>shout</code>), but
others are meant to find something and give it back to you. The
<code>return</code> keyword is how a function hands a value back to the
code that called it.</p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode lua"><code class="sourceCode lua"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> add<span class="op">(</span><span class="va">number1</span><span class="op">,</span> <span class="va">number2</span><span class="op">)</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">local</span> <span class="va">result</span> <span class="op">=</span> <span class="va">number1</span> <span class="op">+</span> <span class="va">number2</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="va">result</span> <span class="co">-- This sends the value of &#39;result&#39; back out.</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="co">-- Call the function and store the returned value in a variable.</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="va">sum</span> <span class="op">=</span> add<span class="op">(</span><span class="dv">5</span><span class="op">,</span> <span class="dv">3</span><span class="op">)</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span><span class="op">(</span><span class="va">sum</span><span class="op">)</span> <span class="co">-- Prints 8</span></span></code></pre></div>
<h2 data-number="6.4" id="your-quest-part-a-the-display-charm"><span
class="header-section-number">6.4</span> Your Quest Part A: The Display
Charm</h2>
<p>Let‚Äôs turn our card-display logic into a function.</p>
<p><strong>Instructions:</strong></p>
<ol type="1">
<li>Near the top of your <code>main.lua</code> file, define a new
function: <code>function display_card(a_card) ... end</code>.</li>
<li>Find your <code>ipairs</code> loop that you used to print the deck.
<strong>Cut</strong> the <code>print</code> statements from inside that
loop.</li>
<li><strong>Paste</strong> those <code>print</code> statements inside
your new <code>display_card</code> function.</li>
<li><strong>Important:</strong> Change the variable you use inside the
function to match the parameter name (e.g., change
<code>card.name</code> to <code>a_card.name</code>).</li>
<li>Now, go back to your main <code>ipairs</code> loop. The inside of
the loop should now just be one line of code: a call to your new
function!
<code>lua     for index, card in ipairs(deck) do       display_card(card) -- Cast the spell on each card in the deck!     end</code></li>
</ol>
<p>Your program will do the same thing, but your main loop is now much
cleaner, and you have a reusable tool for displaying any card you
want.</p>
<h2 data-number="6.5" id="your-quest-part-b-the-seeker-spell"><span
class="header-section-number">6.5</span> Your Quest Part B: The Seeker
Spell</h2>
<p>This is where the real power becomes clear. We‚Äôll turn our ‚ÄúSpeed
Trial‚Äù code into a function and use it on two different decks.</p>
<p><strong>Instructions:</strong></p>
<ol type="1">
<li><p>First, let‚Äôs set up two decks in <code>main.lua</code>. Load your
master list of cards, and then create two smaller decks from it.</p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode lua"><code class="sourceCode lua"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="va">all_cards</span> <span class="op">=</span> <span class="fu">require</span><span class="op">(</span><span class="st">&quot;cards&quot;</span><span class="op">)</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co">-- Create two different decks for our two players.</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="va">player_deck</span> <span class="op">=</span> <span class="op">{</span> <span class="va">all_cards</span><span class="op">[</span><span class="dv">1</span><span class="op">],</span> <span class="va">all_cards</span><span class="op">[</span><span class="dv">3</span><span class="op">]</span> <span class="op">}</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="va">computer_deck</span> <span class="op">=</span> <span class="op">{</span> <span class="va">all_cards</span><span class="op">[</span><span class="dv">2</span><span class="op">],</span> <span class="va">all_cards</span><span class="op">[</span><span class="dv">4</span><span class="op">]</span> <span class="op">}</span> <span class="co">-- Make sure you have at least 4 cards defined!</span></span></code></pre></div></li>
<li><p>Define a new function:
<code>function find_fastest_card(a_deck) ... end</code>.</p></li>
<li><p><strong>Cut</strong> all the logic from your ‚ÄúSpeed Trial‚Äù quest
(creating <code>fastest_card_so_far</code> and the <code>ipairs</code>
loop) and <strong>paste</strong> it inside this new function.</p></li>
<li><p>Adjust the code inside the function to work on the
<code>a_deck</code> parameter instead of the global
<code>deck</code>.</p></li>
<li><p>At the very end of the function, after the loop, add the line:
<code>return fastest_card_so_far</code>.</p></li>
<li><p>Now, in your main code, call your function twice‚Äîonce for each
deck‚Äîand store the results.</p>
<div class="sourceCode" id="cb5"><pre
class="sourceCode lua"><code class="sourceCode lua"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="va">fastest_in_player_deck</span> <span class="op">=</span> find_fastest_card<span class="op">(</span><span class="va">player_deck</span><span class="op">)</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="va">fastest_in_computer_deck</span> <span class="op">=</span> find_fastest_card<span class="op">(</span><span class="va">computer_deck</span><span class="op">)</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span><span class="op">(</span><span class="st">&quot;--- Battle Analysis ---&quot;</span><span class="op">)</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span><span class="op">(</span><span class="st">&quot;Player&#39;s fastest card is: &quot;</span> <span class="op">..</span> <span class="va">fastest_in_player_deck</span><span class="op">.</span><span class="va">name</span><span class="op">)</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span><span class="op">(</span><span class="st">&quot;Computer&#39;s fastest card is: &quot;</span> <span class="op">..</span> <span class="va">fastest_in_computer_deck</span><span class="op">.</span><span class="va">name</span><span class="op">)</span></span></code></pre></div></li>
</ol>
<p>Run your code. You just performed a complex analysis on two different
data sets using a single, reusable spell. This is what programming is
all about!</p>
<h2 data-number="6.6" id="the-troubleshooting-scroll-2"><span
class="header-section-number">6.6</span> The Troubleshooting Scroll</h2>
<ul>
<li><p><strong>Error:
<code>... attempt to concatenate a nil value (local 'fastest_in_player_deck')</code></strong></p>
<ul>
<li><strong>Meaning:</strong> The <code>find_fastest_card</code>
function didn‚Äôt hand anything back, so the variable is empty
(<code>nil</code>).</li>
<li><strong>Check:</strong> Did you remember to put
<code>return fastest_card_so_far</code> at the very end of your
function?</li>
</ul></li>
<li><p><strong>My <code>display_card</code> function isn‚Äôt working and
gives a <code>nil</code> error.</strong></p>
<ul>
<li><strong>Check:</strong> When you defined your function, you gave the
parameter a name, like <code>a_card</code>. Did you remember to use that
<em>exact same name</em> for the variables inside the function (e.g.,
<code>a_card.name</code>, <code>a_card.life</code>)?</li>
</ul></li>
<li><p><strong>I call my function, but nothing happens.</strong></p>
<ul>
<li><strong>Check:</strong> Remember that some functions just
<code>return</code> a value; they don‚Äôt print anything themselves. After
you call <code>find_fastest_card</code>, you need to <code>print</code>
the result that it gave you back.</li>
</ul></li>
</ul>
<nav id="sitenav">
<div class="sitenav">
<span class="navlink next">
<span class="navlink-label">Next Up:</span> <a href="7-the-random-card-forge.html" accesskey="n" rel="next">The Random Card Forge üè≠</a>
</span>
<span class="navlink">
</span>
</div>
<div class="sitenav">
<span class="navlink top">
<a href="index.html" accesskey="t" rel="top">Code &amp; Sorcery: A Lua Card Game Quest</a>
</span>
</div>
</nav>
</body>
</html>
